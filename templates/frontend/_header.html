<div class="top-header-bar navbar-fixed-top">
    <div class="container">
        <div class="logo-menu">
          <a href="/activity">
            <img width="108" height="30" src="/static/images/icons/logo.png" class="hide-div">
          </a>
            <a ng-click="openAside('left')" href="#">
                <img width="27" height="22" src="/static/images/icons/menu.png" class="show-div">
            </a>
        </div>
        <div style="float:right; display:inline-block; border-left:0px solid #ddd; padding:15px 0 6px 0; text-align:right; position:relative;">
            <span class="top-icons"><a href="#"><img width="100%" src="/static/images/icons/noti.png"></a></span>
            <span class="top-icons"><a href="#"><img width="100%" src="/static/images/icons/friendsx.png"></a></span>
            <span class="top-icons"><a href="#"><img width="100%" src="/static/images/icons/mess.png"></a></span>
            <span class="top-drop hide-div">
                <div class="dropdown navbar-right">
                    <span class="nav-profile-pix-img hide-div"><img width="100%" src="/static/images/people/guy-4.jpg"></span>
                    <a style="color:#fff; display:inline-block; vertical-align:top;" aria-expanded="false" role="button" data-toggle="dropdown" class="dropdown-toggle" href="#">
                      <!-- Put name here from context variable -->
                      {% if fullname %}
                        {{ fullname }}
                      {% endif %}
                      Jome Akpoduado  <span class="caret-top"></span>
                    </a>
                    <ul aria-labelledby="dLabel" role="menu" class="dropdown-menu">
                        <li><a href="#">Profile</a></li>
                        <li><a href="#">Messages</a></li>
                        <li><a href="#">Settings</a></li>
                        <li class="divider"></li>
                        <li><a href="/">Logout</a></li>
                    </ul>
                </div>
             </span>

        </div>

        <!--search starts-->
        <div class="search-icon-xs">
            <div id="searchtext">
                <form>
                    <input type="search" id="id-search-text" placeholder="Search for people">
                </form>
            </div>
        </div>
        <div id="search-box">
            <div class="search-holder">
                <div class="search-count"><span id="search-results-count"></span>results found...</div>
                <div id="search-results">

                </div>
                <div class="search-footer"><a>view all results</a></div>
            </div>
        </div>
        <!--search form ends-->

    </div>
    <div style="clear:both;"></div>
</div>

<!-- Implementation of search -->
<script type="text/javascript">
    var search_text = $('#id-search-text').val();
    console.log(search_text);

    // search for first name for now
    var uri = "http://192.168.10.20:9200/info/users/_search?q=firstname:";


    $("#id-search-text").keyup(function(e){
        var query = $('#id-search-text').val();

        if (query.length >= 3) {
            console.log('searching...');

            $("#search-box").show();

            $.ajax({
                url: uri + query + " ",
                type: 'GET',
                success: function (data, status, xhr) {
                    var $results_panel = $("#search-results");
                    $results_panel.html("");

                    $.each(data.hits.hits, function(idx, person){
                        $results_panel.append(
                            "<div class='search-user-card'>" +
                                "<div class='search-user-pix'><img src='static/images/pix.png' width='100%'></div>" +
                                "<div class='search-user-wrapper'>" +
                                    "<a class='search-user-name'>" + person._source.firstname + " " + person._source.lastname + "<span>" + person._source.username + "</span>" +
                                    "</a>" +
                                "</div>" +
                                "<div class='clear'></div>" +
                            "</div>"
                        );
                    });

                    $("#search-results-count").html(data.hits.total);
                },
                error: function () {
                    console.log('could not retrieve search results.');
                    $("#search-results").html("<h3>Could not retrieve search results.</h3>");
                }
            });  
        }
    });

    //close panel
    $(document).keyup(function(event) {
        if(event.which === 27) {
            $('#search-box').hide();
            $('#id-search-text').val();
        }
    });

    $(document).mouseup(function(){
        $('#search-box').hide();
        $('#id-search-text').val("");
    });

</script>